<!-- ç”¨æˆ·ä¿¡æ¯æ¨¡å— -->
<view class="user-section">
  <view class="avatar-wrapper">
    <button 
      wx:if="{{!hasUserInfo}}" 
      class="avatar-button" 
      open-type="chooseAvatar" 
      bindchooseavatar="onChooseAvatar"
    >
      <image class="avatar-img" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
    </button>
    <image wx:else class="avatar-img" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
  </view>
  <input 
    class="nickname-input"
    type="nickname"
    placeholder="è¯·è¾“å…¥æ˜µç§°"
    value="{{userInfo.nickName}}"
    bindinput="onInputChange"
  />
</view>

<!-- åœ°å›¾æ˜¾ç¤ºåŒºåŸŸ -->
<view class="map-wrapper">
  <map
    id="cityMap"
    latitude="{{latitude}}"
    longitude="{{longitude}}"
    scale="14"
    show-location
    polygons="{{polygons}}"
    bindregionchange="handleMapMove"
    style="width: 100%; height: 70vh;"
    setting="{{settings}}"
  >
    <view class="map-controls">
      <image 
        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACHSURBVHgB7dZBCsAgDATQmaD3P+oFPKjYblbQCtb5QMCEl0XAIEnSJ5YrSx0j6hEwO0O8HduZP5oJkKQvGeB6t2UAAAD//+xdjB0T6C3ZAAAAAElFTkSuQmCC" 
        class="recenter-btn"
        bindtap="handleRecenter"
      />
      <view class="counter-badge">
        ğŸŒ å·²æ‰“å¡ {{cityCount}} åŸ
      </view>
    </view>
  </map>
</view>

<!-- åŸå¸‚æ‰“å¡åˆ—è¡¨ -->
<view class="city-list">
  <view class="list-header">
    <text class="header-title">æˆ‘çš„æ—…è¡Œè¶³è¿¹</text>
  </view>
  
  <scroll-view scroll-y class="list-container">
    <block wx:for="{{cityData}}" wx:key="cityName">
      <view class="city-item" bindtap="focusCity" data-city="{{item.cityName}}">
        <view class="city-info">
          <text class="city-name">{{item.cityName}}</text>
          <text class="city-time">é¦–è®¿æ—¶é—´ï¼š{{formatDate(item.firstCheckin)}}</text>
        </view>
        <text class="city-count">åˆ°è®¿{{item.count}}æ¬¡</text>
      </view>
    </block>
    
    <view wx:if="{{cityData.length === 0}}" class="empty-tip">
      ğŸŒ ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è®°å½•ç¬¬ä¸€æ¬¡æ‰“å¡
    </view>
  </scroll-view>
  
  <button class="checkin-btn" bindtap="handleCityCheckin">
    ğŸŒŸ ç«‹å³æ‰“å¡å½“å‰åŸå¸‚
  </button>
</view>
